{{ header }}


  <div class="main-nav-tas">
    <div class="nav main-tabs nav-tabs" id="nav-tab" role="tablist">
      <a class="nav-item nav-link" id="nav-home-tab" href="/" role="tab" aria-controls="nav-home" aria-selected="true"><span>Купить лот</span></a>
      <a class="nav-item nav-link active" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false"><span>Купить бриллиант</span></a> 
    </div>
  </div>
  <div class="container-fluid product-container">  
    <div class="tab-content" id="nav-tabContent">
      <div class="tab-pane fade" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
        <div class="container">
          <div class="row">
            <div class="col">
              <h2 class="page-title"></h2>
            </div>
          </div>  
        </div>
      </div>
      <div class="tab-pane fade show active" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
        <div class="container">
          <div class="row">
              <div class="col">
                <div class="page-title-row justify-content-start">
                  <h2 class="page-back-link"><a href="{{ home_link }}">ВЕРНУТЬСЯ К ВЫБОРУ</a></h2> 
                </div>
              </div>
          </div>
          <div class="row">
            <div class="col-md-12"> 
              <div class="card product-card  product-card-full p-0">
                <div class="col-sm-6 col-img p-0">
                  <div class="slider-main">
                    
                    <div class="mz-3dimages">
                    {% for image in images_3d %}
                    <img src="{{ image }}" alt="3D Image Frame">
                    {% endfor %}
                    </div>

                    {% for image in images %}
                      <div>
                        <img src="{{ image.thumb }}" alt="{{ heading_title }}">
                      </div>
                    {% endfor %}

                  </div>
                  
                  <div class="slider-nav">
                    {# Это надо заменить на первое (или любое) изображение из 3д превью #}
                    <!---->
                    <div class="nav-pic">
                        <img src="http://bestfriends.ru/image/cache/catalog/bfr_products/diamond-1-343x343.png" alt="Особый бриллиант 4.44  ">
                    </div>
                    <!---->
                    {# Это надо заменить на первое (или любое) изображение из 3д превью #}

                    {% for image in images %}
                      <div class="nav-pic">
                        <img src="{{ image.thumb }}" alt="{{ heading_title }}">
                      </div>
                    {% endfor %}

                  </div>
                </div>
                <div class="col-sm-6 col-info">
                  <div class="head-panel">
                    <div class="product-title">
                      <a href="{{ href }}">{{ heading_title | replace({"ct" : ""}) }} <span class="lower-ct">ct</span> </a>
                    </div>
                    <div class="like-btn"><a href=""><img src="catalog/view/theme/bfr/image/like-btn.png" alt=""></a></div>
                  </div>
                  <div class="card-body info-panel d-flex justify-content-beetwen"> 
                    <div class="col-6 p-0">

                      {% for attribute_group in attribute_groups %}
                        {% for attribute in attribute_group.attribute %}
                        {% if attribute.attribute_id == 14 or attribute.attribute_id == 15 %}
                          <div class="info-item"><span class="info-item-title">{{ attribute.name }}: </span>{{ attribute.text }}</div>
                          {% endif %}
                        {% endfor %}
                      {% endfor %}
                      
                      <div class="info-item"><span class="info-item-title">Артикул: </span>{{ model }}</div>
                    </div>
                    <div class="col-6 p-0">
                      <div class="price-panel"><span class="price-item-product">{{ price | number_format(0, ',', ' ') }} руб</span></div> 
                      
                      <button class="main-btn" onclick="cart.add('{{ product_id }}')">ВЫБРАТЬ</button>
                    </div>
                  </div>
                  <div class="product-description">
                    <h3>Описание</h3>
                    <p>Этот круглый бриллиант 2.15 карат имеет отличные характеристики. Подойдет как для создания уникального украшения так и в качестве инвестиции. Прошел сертификацию GIA.</p>
                  </div>
                  <div class="product-share-row">
                    <a href=""><img src="catalog/view/theme/bfr/image/share-ico/facebook-app-logo.svg" alt="" class="img-svg"></a>
                    <a href=""><img src="catalog/view/theme/bfr/image/share-ico/telegram.svg" alt="" class="img-svg"></a>
                    <a href=""><img src="catalog/view/theme/bfr/image/share-ico/whatsapp.svg" alt="" class="img-svg"></a>
                    <a href=""><img src="catalog/view/theme/bfr/image/share-ico/twitter.svg" alt="" class="img-svg"></a>
                    <a href=""><img src="catalog/view/theme/bfr/image/share-ico/email.svg" alt="" class="img-svg"></a>
                  </div>
                </div> 
              </div> 
            </div> 
          </div>  

         
            <style>
                .mz-none {
                    display: none;
                }                
                
                .mz-3dimages img:not(:first-child) {
                    position: absolute;
                    top: 0;
                    left: 0;
                    z-index: 1;
                }
            </style>
            
            <script>
                let mover = false;
                let counter = 0;
                let prev_frame = 0;
                let direction = 0;
                
                var mz3dimages = document.querySelector(".mz-3dimages");
                let mz3dimagesTags = mz3dimages.querySelectorAll("img");
                let images_per_width = mz3dimages.scrollWidth / (mz3dimages.getElementsByTagName("img").length - 1);

                
                mz3dimages.addEventListener("touchstart", function(event){
                    mover = true;
                });
                
                mz3dimages.addEventListener("touchmove", function(event){
                    let ox = parseInt(event.targetTouches[0].pageX - mz3dimages.getBoundingClientRect().x);                    
                    
                    mz3dimagesTags.forEach(function(e){
                        e.style.zIndex = 1;
                    })
                    
                    let image_to_show = parseInt( ox / images_per_width );
                    mz3dimages.children[image_to_show].style.zIndex = 2;
                    counter = image_to_show;
                    
                    if (prev_frame > image_to_show ) {
                        direction = 1;
                    } else if(prev_frame < image_to_show ) {
                        direction = 0;
                    }
                    prev_frame = image_to_show;
                });
                
                mz3dimages.addEventListener("touchend", function(event){
                    mover = false;
                });
                
                
                mz3dimages.addEventListener("mousemove", function(event){
                    mover = true;
                    mz3dimagesTags.forEach(function(e){
                        e.style.zIndex = 1;
                    })
                    let image_to_show = parseInt( event.layerX / images_per_width );
                    mz3dimages.children[image_to_show].style.zIndex = 2;
                    counter = image_to_show;
                    if (prev_frame > image_to_show ) {
                        direction = 1;
                    } else {
                        direction = 0;
                    }
                    prev_frame = image_to_show;
                });
                
                mz3dimages.addEventListener("mouseleave", function(event){
                    mover = false;
                })
                
                
                setInterval(function(e){
                    if( !mover ) {
                        mz3dimagesTags.forEach(function(e){
                            e.style.zIndex = 1;
                        })

                        mz3dimages.children[counter].style.zIndex = 2;
                        if( direction == 0 ) {
                            counter++;
                        } else {
                            counter--;
                        }                        
                        
                        if( counter > mz3dimages.getElementsByTagName("img").length - 1) {
                            counter = 0;
                        }
                        if( counter < 0 ) {
                            counter = mz3dimages.getElementsByTagName("img").length - 1;
                        }
                    }                    
                },75)
            </script>
          {# картинки для 3D #}

          {% if images_3d %}
            <div class="row mz-none">

                <b>Директория абс.</b>
                <br>
                  {{ images_3d_dir_abs }}
                <br>
                
                <b>Директория</b>
                <br>
                  {{ images_3d_dir }}
                <br>
                
                
              </div>
            </div>
          {% endif %}

          {# картинки для 3D #}

          <div class="row"> 
            <div class="col-md-12"> 
              <div class="about-product">
                <h3>Узнайте о своем бриллианте</h3>
                <div class="panel-group" id="accordion">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse1" class="collapsed">
                        Карат 2.15 <img src="catalog/view/theme/bfr/image/minus-sign.svg" alt="" class="img-svg minus-ico "><img src="catalog/view/theme/bfr/image/plus.svg" alt="" class="img-svg plus-ico"></a>
                      </h4>
                    </div>
                    <div id="collapse1" class="panel-collapse collapse">
                      <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipisicing elit,
                      sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad
                      minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
                      commodo consequat.</div>
                    </div>
                  </div>
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse2" class="collapsed">
                        Цвет D <img src="catalog/view/theme/bfr/image/minus-sign.svg" alt="" class="img-svg minus-ico "><img src="catalog/view/theme/bfr/image/plus.svg" alt="" class="img-svg plus-ico"></a>
                      </h4>
                    </div>
                    <div id="collapse2" class="panel-collapse collapse">
                      <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipisicing elit,
                      sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad
                      minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
                      commodo consequat.</div>
                    </div>
                  </div>
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse3" class="collapsed">
                        Чистота IF <img src="catalog/view/theme/bfr/image/minus-sign.svg" alt="" class="img-svg minus-ico "><img src="catalog/view/theme/bfr/image/plus.svg" alt="" class="img-svg plus-ico"></a>
                      </h4>
                    </div>
                    <div id="collapse3" class="panel-collapse collapse">
                      <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipisicing elit,
                      sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad
                      minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
                      commodo consequat.</div>
                    </div>
                  </div>
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse4" class="collapsed">
                        Огранка <img src="catalog/view/theme/bfr/image/minus-sign.svg" alt="" class="img-svg minus-ico "><img src="catalog/view/theme/bfr/image/plus.svg" alt="" class="img-svg plus-ico"></a>
                      </h4>
                    </div>
                    <div id="collapse4" class="panel-collapse collapse">
                      <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipisicing elit,
                      sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad
                      minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
                      commodo consequat.</div>
                    </div>
                  </div>
                </div>
              </div>
            </div> 
          </div>  
        </div>
      </div> 
    </div>
  </div>


<!-- Add to cart Modal -->
<div id="add-to-cart-modal" class="modal fade add-to-cart-modal" role="dialog">
  <div class="modal-dialog modal-dialog-centered">

    <!-- Modal content-->
    <div class="modal-content" style="max-width: none;">
      <div class="modal-header">
      </div>
      <div class="modal-body">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Позиция добавленна в заказ</h4>
              <div class="card product-card p-0">
                <div class="col-6 col-img p-0">
                  <img src="{{ thumb }}" alt="{{ heading_title }}">
                </div>
                <div class="col-6 col-info">
                  <div class="head-panel">
                    <div class="product-title">
                      <a href="{{ href }}">{{ heading_title | replace({"ct" : ""}) }} <span class="lower-ct">ct</span> </a>
                    </div> 
                  </div>
                  <div class="card-body info-panel">
                    <div class="info-item"><span class="info-item-title">Артикул: </span>{{ model }}</div>

                    {% for attribute in attribute_groups.0.attribute %}
                      {# {% if attribute.attribute_id == 14 or attribute.attribute_id == 15 %} #}
                      {% if attribute.attribute_id != 17 %}
                        <div class="info-item"><span class="info-item-title">{{ attribute.name }}: </span>{{ attribute.text }}</div>                         
                      {% endif %}
                    {% endfor %}


                  </div>
                  <div class="price-panel"><span class="info-item-title">Цена: </span><span class="price-item-product">{{ price | number_format(0, ',', ' ') }} руб</span></div>  
                </div> 
              </div>
      </div>
      <div class="modal-footer"> 
        <a href="#"  data-dismiss="modal" class="trans-btn">Продолжить покупки</a>
        <a href="{{ cart_link }}" class="main-btn confirm-order">Оформить заказ</a>
      </div>
    </div>

  </div>
</div>


{{ footer }} 
